<!DOCTYPE html>
<html>
<head>
    <title>Train Puzzle</title>
    <style>
        #gameCanvas {
            background-color: #eee;
            border: 1px solid black;
        }

        #controls {
            margin-top: 20px;
            font-family: sans-serif;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div id="controls">
        <p>Controls:</p>
        <p>A: Switch 1</p>
        <p>F: Switch 2</p>
        <p>O: Switch 3</p>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // --- Constants ---
        const TRAIN_WIDTH = 20;
        const TRAIN_HEIGHT = 15;
        const TRAIN_SPEED = 1;

        const SWITCH_WIDTH = 30;
        const SWITCH_HEIGHT = 10;

        const RAIL_WIDTH = 10;
        const RAIL_TIE_WIDTH = 5;

        // --- Game State ---
        let trains = [];
        let switches = [
            { x: 200, y: 150, state: 0 }, // Switch 1 (0: top, 1: bottom)
            { x: 400, y: 75, state: 0 },  // Switch 2 (0: top, 1: bottom)
            { x: 400, y: 225, state: 0 }   // Switch 3 (0: top, 1: bottom)
        ];

        const endpoints = [
          {x: 600, y: 50},
          {x: 600, y: 100},
          {x: 600, y: 200},
          {x: 600, y: 250}
        ];


        // --- Train Data ---
        const trainColors = ['red', 'blue', 'green', 'orange'];
        let trainSpawnTimer = 0;
        const trainSpawnInterval = 150; // Frames

        // --- Functions ---

        function drawRail(x1, y1, x2, y2) {
            ctx.strokeStyle = 'gray';
            ctx.lineWidth = RAIL_WIDTH;
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();

            // Draw rail ties
            const numTies = Math.floor(Math.sqrt((x2 - x1)**2 + (y2 - y1)**2) / 20);
            for (let i = 0; i < numTies; i++) {
                const tieX = x1 + (x2 - x1) * (i / numTies);
                const tieY = y1 + (y2 - y1) * (i / numTies);
                ctx.fillStyle = 'brown';
                ctx.fillRect(tieX - RAIL_TIE_WIDTH / 2, tieY - RAIL_WIDTH / 2, RAIL_TIE_WIDTH, RAIL_WIDTH);
            }
        }

        function drawSwitch(x, y, state) {
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 3;
            ctx.beginPath();

            if (state === 0) {
                // Top path
                ctx.moveTo(x, y);
                ctx.quadraticCurveTo(x + SWITCH_WIDTH / 2, y - 15, x + SWITCH_WIDTH, y - 10);
            } else {
                // Bottom path
                ctx.moveTo(x, y);
                ctx.quadraticCurveTo(x + SWITCH_WIDTH / 2, y + 15, x + SWITCH_WIDTH, y + 10);
            }
            ctx.stroke();
        }

        function drawTrain(train) {
            ctx.fillStyle = train.color;
            ctx.fillRect(train.x, train.y, TRAIN_WIDTH, TRAIN_HEIGHT);
        }

       function updateTrain(train) {
            // Basic path following
            if (train.x < switches[0].x) {
                train.x += TRAIN_SPEED; // Move right to switch 1
            } else if (train.x >= switches[0].x && train.x < switches[0].x + SWITCH_WIDTH) {
                // At switch 1
                if (switches[0].state === 0) {
                    train.x += TRAIN_SPEED; // Continue on top path
                } else {
                    train.x += TRAIN_SPEED;
                    train.y = 250;
                }
            } else if (train.x >= switches[0].x + SWITCH_WIDTH && train.y < switches[1].y && switches[0].state == 0) {
              train.x += TRAIN_SPEED;
              train.y = 50;
            }
            else if (train.x >= switches[0].x + SWITCH_WIDTH && train.y > switches[2].y && switches[0].state == 1) {
              train.x += TRAIN_SPEED;
              train.y = 200;
            }
            else if(train.x >= switches[1].x && train.x < switches[1].x + SWITCH_WIDTH){
                if (switches[1].state === 0) {
                    train.x += TRAIN_SPEED; // Continue on top path
                } else {
                    train.x += TRAIN_SPEED;
                    train.y = 75;
                }
            }

             else if(train.x >= switches[2].x && train.x < switches[2].x + SWITCH_WIDTH){
                if (switches[2].state === 0) {
                    train.x += TRAIN_SPEED; // Continue on top path
                } else {
                    train.x += TRAIN_SPEED;
                    train.y = 225;
                }
            }
             else {
                train.x += TRAIN_SPEED;
             }

            // Add more logic to handle switches 2 and 3, and the final paths to endpoints
        }

        function spawnTrain() {
            const colorIndex = Math.floor(Math.random() * trainColors.length);
            const color = trainColors[colorIndex];
            trains.push({ x: 50, y: 150, color: color }); // Start position
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw rails
            drawRail(50, 150, switches[0].x, 150); // Initial rail to switch 1

            // Switch 1
            drawRail(switches[0].x + SWITCH_WIDTH, 140, 300, 75); // Top path from switch 1
            drawRail(switches[0].x + SWITCH_WIDTH, 160, 300, 225); // Bottom path from switch 1

            // Switches 2 and 3
            drawRail(300, 75, switches[1].x, 75); // Rail to switch 2
            drawRail(300, 225, switches[2].x, 225); // Rail to switch 3

            // Switch 2
            drawRail(switches[1].x + SWITCH_WIDTH, 75, 600, 50); // Top path from switch 2
            drawRail(switches[1].x + SWITCH_WIDTH, 75, 600, 100); // Bottom path from switch 2

            // Switch 3
            drawRail(switches[2].x + SWITCH_WIDTH, 225, 600, 200); // Top path from switch 3
            drawRail(switches[2].x + SWITCH_WIDTH, 225, 600, 250); // Bottom path from switch 3

            // Draw switches
            switches.forEach(sw => drawSwitch(sw.x, sw.y, sw.state));

            // Draw trains
            trains.forEach(train => drawTrain(train));
        }

        function update() {
            trains.forEach(updateTrain);

            // Spawn trains periodically
            trainSpawnTimer++;
            if (trainSpawnTimer > trainSpawnInterval) {
                spawnTrain();
                trainSpawnTimer = 0;
            }
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // --- Event Listeners ---
        document.addEventListener('keydown', (event) => {
            if (event.key === 'a' || event.key === 'A') {
                switches[0].state = 1 - switches[0].state; // Toggle switch 1
            } else if (event.key === 'f' || event.key === 'F') {
                switches[1].state = 1 - switches[1].state; // Toggle switch 2
            } else if (event.key === 'o' || event.key === 'O') {
                switches[2].state = 1 - switches[2].state; // Toggle switch 3
            }
        });

        // --- Start Game ---
        gameLoop();
    </script>
</body>
</html>
