<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Train Switch Game</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #f0f0f0;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(5, 60px);
      grid-template-rows: repeat(5, 60px);
      gap: 2px;
      margin-top: 20px;
    }
    .cell {
      width: 60px;
      height: 60px;
      background: #ccc;
      border: 1px solid #999;
      position: relative;
    }
    .track {
      background-color: #888;
    }
    .switch {
      background-color: #555;
      cursor: pointer;
    }
    .switch.straight::after {
      content: 'â†•';
      color: white;
      font-size: 20px;
      position: absolute;
      top: 18px;
      left: 22px;
    }
    .switch.turn::after {
      content: 'â†±';
      color: white;
      font-size: 20px;
      position: absolute;
      top: 18px;
      left: 22px;
    }
    .train {
      width: 100%;
      height: 100%;
      background-color: red;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 2;
    }
    .entry {
      background-color: green;
    }
    .exit {
      background-color: red;
    }
  </style>
</head>
<body>
  <h1>ðŸš† Ù„Ø¹Ø¨Ø© Ø§Ù„Ø³ÙƒÙƒ Ø§Ù„Ø­Ø¯ÙŠØ¯ÙŠØ©</h1>
  <div id="game" class="grid"></div>
  <script>
    const gridSize = 5;
    const grid = document.getElementById("game");

    // Map of grid: 0 = empty, T = track, S = switch, E = entry, X = exit
    const map = [
      ["E", "T", "S", "T", "X"],
      ["",  "",  "",  "",  ""],
      ["",  "",  "",  "",  ""],
      ["",  "",  "",  "",  ""],
      ["",  "",  "",  "",  ""]
    ];

    const switches = {}; // Store switch states
    const train = { x: 0, y: 0, color: "red", dir: "right" };

    function createCell(x, y, type) {
      const cell = document.createElement("div");
      cell.classList.add("cell");
      if (type === "T") cell.classList.add("track");
      if (type === "S") {
        cell.classList.add("switch", "straight");
        switches[`${x},${y}`] = "straight";
        cell.addEventListener("click", () => toggleSwitch(x, y, cell));
      }
      if (type === "E") cell.classList.add("entry");
      if (type === "X") cell.classList.add("exit");
      cell.id = `cell-${x}-${y}`;
      grid.appendChild(cell);
    }

    function toggleSwitch(x, y, el) {
      const current = switches[`${x},${y}`];
      const next = current === "straight" ? "turn" : "straight";
      switches[`${x},${y}`] = next;
      el.classList.toggle("straight");
      el.classList.toggle("turn");
    }

    function drawGrid() {
      for (let y = 0; y < gridSize; y++) {
        for (let x = 0; x < gridSize; x++) {
          createCell(x, y, map[y][x]);
        }
      }
    }

    function placeTrain() {
      const cell = document.getElementById(`cell-${train.x}-${train.y}`);
      const t = document.createElement("div");
      t.className = "train";
      t.style.backgroundColor = train.color;
      cell.appendChild(t);
    }

    function moveTrain() {
      const dirMap = {
        right: [1, 0],
        down: [0, 1],
        turn: [0, 1],
      };
      const [dx, dy] = dirMap[train.dir];

      const prevCell = document.getElementById(`cell-${train.x}-${train.y}`);
      prevCell.innerHTML = "";

      train.x += dx;
      train.y += dy;

      const key = `${train.x},${train.y}`;
      if (switches[key]) {
        train.dir = switches[key] === "straight" ? "right" : "down";
      }

      const cell = document.getElementById(`cell-${train.x}-${train.y}`);
      if (!cell || cell.classList.contains("cell") === false) {
        alert("ðŸ’¥ ØªØµØ§Ø¯Ù… Ø§Ù„Ù‚Ø·Ø§Ø± Ø£Ùˆ Ø®Ø±Ø¬ Ø¹Ù† Ø§Ù„Ù…Ø³Ø§Ø±! Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
        location.reload();
        return;
      }
      if (cell.classList.contains("exit")) {
        alert("ðŸŽ‰ ÙˆØµÙ„Øª Ø§Ù„Ù‚Ø·Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­!");
        return;
      }

      const t = document.createElement("div");
      t.className = "train";
      t.style.backgroundColor = train.color;
      cell.appendChild(t);
    }

    drawGrid();
    placeTrain();

    setInterval(() => {
      moveTrain();
    }, 1000);
  </script>
</body>
</html>
